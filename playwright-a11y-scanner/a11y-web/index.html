<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>a11y-scan launcher</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 0; padding: 28px; background: #0b0f17; color: #e6edf3; }
    .wrap { max-width: 900px; margin: 0 auto; }
    h1 { margin: 0 0 8px; font-size: 22px; }
    p { margin: 0 0 18px; opacity: .85; line-height: 1.45; }
    textarea {
      width: 100%; height: 240px; resize: vertical;
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.12);
      color: #e6edf3;
      border-radius: 12px;
      padding: 12px;
      font-size: 14px;
      line-height: 1.4;
    }
    .row { display: flex; gap: 10px; margin-top: 12px; flex-wrap: wrap; }
    button, a.btn {
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      color: #e6edf3;
      padding: 10px 12px;
      border-radius: 10px;
      font-size: 14px;
      cursor: pointer;
      text-decoration: none;
      display: inline-block;
    }
    button:hover, a.btn:hover { background: rgba(255,255,255,.10); }
    .log {
      margin-top: 16px;
      background: rgba(0,0,0,.25);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 12px;
      padding: 12px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      font-size: 12px;
      white-space: pre-wrap;
      line-height: 1.4;
      min-height: 90px;
    }
    .muted { opacity: .75; font-size: 13px; margin-top: 10px; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>a11y-scan launcher</h1>
    <p>Paste one URL per line and click <strong>Run Scan</strong>. When finished, open the dashboard.</p>

    <textarea id="urls" placeholder="https://example.com
https://salesforce.com
# lines starting with # are ignored"></textarea>

    <div class="row">
      <button id="run">Run Scan</button>
      <a class="btn" href="/reports/index.html" target="_blank" rel="noreferrer">Open Dashboard</a>
      <a class="btn" href="/reports/latest.html" target="_blank" rel="noreferrer">Open Latest Report</a>
    </div>

    <div class="muted">Tip: This runs scans sequentially for stability.</div>
    <div id="log" class="log">Ready.</div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);
    const log = (msg) => {
      $("log").textContent += "\\n" + msg;
      $("log").scrollTop = $("log").scrollHeight;
    };

    $("run").addEventListener("click", async () => {
      const urls = $("urls").value;
      $("log").textContent = "";
      log("Starting scan...");

      try {
        const res = await fetch("/api/scan", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ urls })
        });

        let data;
        try {
          data = await res.json();
        } catch {
          const text = await res.text().catch(() => "");
          throw new Error(`Server response not JSON (status ${res.status}). ${text.slice(0,200)}`);
        }

        if (!res.ok) throw new Error(data.error || `Server error (status ${res.status})`);

        log("✅ Completed.");
        log("Scanned: " + data.scanned);

        if (data.failed && data.failed.length) {
          log("⚠ Failed:");
          data.failed.forEach(f => log(" - " + f.url + " :: " + f.error));
        } else {
          log("No failures.");
        }

        log("");
        log("Dashboard: " + data.dashboardUrl);
        log("Latest report: " + data.latestUrl);
      } catch (e) {
        log("❌ Exception: " + e.message);
      }
    });
  </script>
</body>
</html>
